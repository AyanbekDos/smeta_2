# Telegram-бот для обработки PDF-спецификаций металлопроката

Этот проект представляет собой асинхронного Telegram-бота на `python-telegram-bot` для автоматизации процесса извлечения данных из PDF-документов со спецификациями металлопроката.

## Основной рабочий процесс (Workflow)

1.  **Старт**: Пользователь отправляет команду `/start`.
2.  **Загрузка PDF**: Бот принимает PDF-файл.
3.  **Валидация "КМД"**: Проверяется имя файла и текст на первой странице. При нахождении "КМД" обработка останавливается.
4.  **Поиск страницы (AI)**: PDF анализируется языковой моделью для нахождения номера страницы со спецификацией.
5.  **Подтверждение пользователем**: Бот отправляет изображение найденной страницы и кнопки "Да/Нет". Если пользователь нажимает "Нет", бот запрашивает номер страницы вручную.
6.  **OCR и структурирование (AI)**: Подтвержденная страница распознается, и сырой текст отправляется в языковую модель для извлечения данных в строго иерархический JSON.
7.  **Генерация отчетов**: Из JSON создается "плоский" pandas DataFrame, на основе которого генерируются файлы `.xlsx` и `.txt`.
8.  **Отправка результатов**: Пользователю отправляется текстовое превью, а затем файлы `.xlsx` и `.txt`.

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/AyanbekDos/smeta_2.git
    cd smeta_2
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Linux/macOS
    # venv\Scripts\activate  # Для Windows
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройте переменные окружения:**
    - Скопируйте файл с примером: `cp .env.example .env`
    - Откройте файл `.env` и впишите ваши API-ключи и другие необходимые значения.

5.  **Запустите бота:**
    ```bash
    python main_bot.py
    ```

## Конфигурация и адаптация

### Переменные окружения

Все ключи API и эндпоинты должны быть заданы в файле `.env`.

### Настройка промптов (Важно!)

Эффективность анализа документов напрямую зависит от качества промптов (инструкций для языковой модели). Вы можете и должны адаптировать их под ваши конкретные нужды и форматы документов.

В проекте есть два ключевых файла с промптами:

-   `find_and_validate.txt`: Этот промпт используется для поиска номера страницы, содержащей основную таблицу со спецификацией.
-   `extract_and_correct.txt`: Этот промпт используется на втором этапе для извлечения, структурирования и коррекции данных из текста, полученного после оптического распознавания (OCR).

**Откройте эти файлы и измените инструкции, чтобы улучшить точность и релевантнсть извлекаемых данных для ваших PDF-файлов.**
